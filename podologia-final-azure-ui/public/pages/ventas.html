<!doctype html>
<html>
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Ventas</title>
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
<div class="app">
  <aside class="sidebar">
    <div class="brand"><div class="logo">P</div><div><h1>Podología</h1><div style="font-size:12px;color:var(--muted)">Panel</div></div></div>
    <nav class="nav">
      <a href="/pages/admin.html"><span class="ico"><i class="fa-solid fa-house"></i></span> Dashboard</a>
      <a href="/pages/productos.html"><span class="ico"><i class="fa-solid fa-box"></i></span> Productos</a>
      <a href="/pages/clientes.html"><span class="ico"><i class="fa-solid fa-user"></i></span> Clientes</a>
      <a href="/pages/proveedores.html"><span class="ico"><i class="fa-solid fa-truck"></i></span> Proveedores</a>
      <a href="/pages/inventario.html"><span class="ico"><i class="fa-solid fa-warehouse"></i></span> Inventario</a>
      <a href="/pages/ventas.html" class="active"><span class="ico"><i class="fa-solid fa-cash-register"></i></span> Ventas</a>
    </nav>
    <div style="margin-top:18px"><a href="#" id="logout" class="nav"><span class="ico"><i class="fa-solid fa-arrow-right-from-bracket"></i></span> Cerrar sesión</a></div>
  </aside>

  <main class="main">
    <div class="topbar">
      <div class="search card"><i class="fa-solid fa-magnifying-glass" style="margin-right:8px;color:var(--muted)"></i><input placeholder="Buscar ventas..." id="search" /></div>
      <div class="actions"><a class="button" id="newSale">Registrar venta</a></div>
    </div>

    <div class="card">
      <h3>Registrar venta</h3>
      <form id="ventaForm">
        <div class="form-row">
          <input class="input" name="ID_cliente" placeholder="ID cliente" required />
          <textarea class="input" name="items" placeholder='Ej: [{"ID_producto":1,"cantidad":1,"precio_unitario":10.0}]' required></textarea>
          <input class="input" name="total_pagar" placeholder="Total" required />
        </div>
        <div style="margin-top:10px">
          <button class="button">Registrar</button>
        </div>
      </form>
      <div id="msg" style="margin-top:12px;color:var(--muted)"></div>
    </div>
  </main>
</div>

<script>
document.getElementById('ventaForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const fd = new FormData(e.target);
  const payload = { ID_cliente: parseInt(fd.get('ID_cliente')), items: JSON.parse(fd.get('items')), total_pagar: parseFloat(fd.get('total_pagar')) };
  const res = await fetch('/api/ventas', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload), credentials:'include'});
  const j = await res.json();
  document.getElementById('msg').innerText = j.message || JSON.stringify(j);
});
document.getElementById('logout').addEventListener('click', async (e)=>{e.preventDefault(); await fetch('/api/auth/logout',{method:'POST', credentials:'include'}); window.location='/'});
</script>
</body>
</html>
