
<!doctype html><html><head><meta charset="utf-8"><title>Ventas</title><link rel="stylesheet" href="/assets/styles/dark.css"></head>
<body class="dark"><div class="card"><h2>Vender</h2>
<form id="frmSell"><label>Cliente ID: <input name="cliente" /></label><div id="items"></div><button type="button" id="addItem">AÃ±adir Item</button><button type="submit">Vender</button></form></div>
<script>
let items=[];
document.getElementById('addItem').addEventListener('click', ()=>{ items.push({ID_producto:'',cantidad:1,precio_unitario:0}); renderItems(); });
function renderItems(){ const div=document.getElementById('items'); div.innerHTML=''; items.forEach((it,idx)=>{ const r=document.createElement('div'); r.innerHTML=`Producto ID: <input data-idx="${idx}" class="prod" value="${it.ID_producto}"/> Cant: <input data-idx="${idx}" class="cant" value="${it.cantidad}"/> Precio: <input data-idx="${idx}" class="pre" value="${it.precio_unitario}"/> <button onclick="rem(${idx})">Quitar</button>`; div.appendChild(r); }); }
function rem(i){ items.splice(i,1); renderItems(); }
document.getElementById('frmSell').addEventListener('submit', async (e)=>{ e.preventDefault(); const cliente=document.querySelector('input[name=cliente]').value; const res=await fetch('/api/sales',{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ ID_cliente: cliente, items: items, total: items.reduce((s,it)=>s + (it.cantidad*it.precio_unitario),0) }) }); if(res.ok){ alert('Venta registrada'); items=[]; renderItems(); }else alert('Error'); });
renderItems();
</script></body></html>
